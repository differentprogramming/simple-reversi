// consolegame.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <functional>
#include <assert.h>

//#define NO_OPTIMIZATION

typedef uint8_t Square;
typedef uint16_t Safety;

typedef Safety CompressedBoard[8];

#define TranspositionTableLenLn2 24

#if (TranspositionTableLenLn2 <= 21)

#define PRIME1 211
#define PRIME2 223
#define PRIME3 227
#define PRIME4 229
#define PRIME5 233
#define PRIME6 239
#define PRIME7 241
#define PRIME8 251

#elif (TranspositionTableLenLn2 == 24)

#define PRIME1 1997
#define PRIME2 1999
#define PRIME3 2003
#define PRIME4 2011
#define PRIME5 2017
#define PRIME6 2027
#define PRIME7 2029
#define PRIME8 2039

#else

#define PRIME1 8111	
#define PRIME2 8117	
#define PRIME3 8123	
#define PRIME4 8147	
#define PRIME5 8161	
#define PRIME6 8167
#define PRIME7 8171	
#define PRIME8 8179

#endif 

typedef Square BoardArray[100];
struct ValTriple { int pos; int dir; int len; };
const ValTriple Valuations[] =
{
	{ 81,1,8 },{ 71,1,8 },
	{ 61,1,8 },{ 51,1,8 },
	{ 41,1,8 },{ 31,1,8 },
	{ 21,1,8 },{ 11,1,8 },
	{ 81,11,1 },{ 18,11,1 },
	{ 71,11,2 },{ 17,11,2 },
	{ 61,11,3 },{ 16,11,3 },
	{ 51,11,4 },{ 15,11,4 },
	{ 41,11,5 },{ 14,11,5 },
	{ 31,11,6 },{ 13,11,6 },
	{ 21,11,7 },{ 12,11,7 },
	{ 11,9,1 },{ 88,9,1 },
	{ 11,10,8 },{ 12,10,8 },
	{ 12,9,2 },{ 78,9,2 },
	{ 13,9,3 },{ 68,9,3 },
	{ 13,10,8 },{ 14,10,8 },
	{ 14,9,4 },{ 58,9,4 },
	{ 15,9,5 },{ 48,9,5 },
	{ 15,10,8 },{ 16,10,8 },
	{ 16,9,6 },{ 38,9,6 },
	{ 17,9,7 },{ 28,9,7 },
	{ 17,10,8 },{ 18,10,8 },
	{ 18,9,8 },
	{ 11,11,8 },
	{ 0,0,0 }
};
Safety compress_a[256];
Safety compress_b[256];
void init_compress()
{
	for (int c = 0;c<256;++c)
		compress_a[c] = (c & 3) + ((((c & 0xc) * 12288) + ((c & 0x30) * 9216)
			+ ((c & 0xc0) * 6912)) >> 14);

	for (int c = 256;c < 65536;c += 256)
		compress_b[c >> 8] = ((((c & 0x300) * 5184)
			+ ((c & 0xc00) * 3888) + ((c & 0x3000) * 2916) + ((c & 0xc000) * 2187)) >> 14);
}
//reduce cache pressure by converting base 3 index to compressed form
inline Safety compress3(int c)
{
	return compress_a[c & 255] + compress_b[c >> 8];
}

struct TranspositionEntry {
	CompressedBoard b;
	int value;
	int depth;
	TranspositionEntry() :value(0),depth(0)
	{
		b[0] = b[1] = b[2] = b[3] = b[4] = b[5] = b[6] = b[7] = 0;
	}

	static int hash(CompressedBoard o)
	{//all numbers are prime
		return ((1 << TranspositionTableLenLn2) - 1)&(o[0] * PRIME1 + o[1] * PRIME2 + o[2] * PRIME3 + o[3] * PRIME4 + o[4] * PRIME5 + o[5] * PRIME6 + o[6] * PRIME7 + o[7] * PRIME8);
	}
	bool equal(CompressedBoard o,int d) {
		return depth==d && b[0] == o[0] && b[1] == o[1] && b[2] == o[2] && b[3] == o[3] && b[4] == o[4] && b[5] == o[5] && b[6] == o[6] && b[7] == o[7];
	}
	static bool find_and_fill(int *&to_store, CompressedBoard o, int d);
	static bool find_and_fill(int *&to_store, BoardArray o, int d);
};

TranspositionEntry TranspositionTable[1 << TranspositionTableLenLn2];
//static 
bool TranspositionEntry::find_and_fill(int *&to_store, BoardArray in, int d)
{
	CompressedBoard cbs;
	for (int i = 0;i < 8; i += 2) {
		int c = 0;
		int c2 = 0;

		for (int j = Valuations[i].pos, j2 = Valuations[1 + i].pos, k = 1;k <= Valuations[i].len;++k, j += Valuations[i].dir, j2 += Valuations[i].dir) {
			c = (c << 2) + in[j];
			c2 = (c2 << 2) + in[j2];
		}

		cbs[i] = compress3(c);
		cbs[i + 1] = compress3(c2);
	}
	return find_and_fill(to_store, cbs, d);
}
bool TranspositionEntry::find_and_fill(int *&to_store, CompressedBoard o, int d)
{
	int h = hash(o);
	TranspositionEntry &t = TranspositionTable[h];
	to_store = &t.value;

	if (t.equal(o,d)) {
		return true;
	}
	t.depth = d;
	t.b[0] = o[0];
	t.b[1] = o[1];
	t.b[2] = o[2];
	t.b[3] = o[3];
	t.b[4] = o[4];
	t.b[5] = o[5];
	t.b[6] = o[6];
	t.b[7] = o[7];
	return false;
}

const int QUIESCENT_DEPTH = 0;

const Square Out = 4;
const Square Empty = 0;
const Square White = 1;
const Square Black = 2;
//black p
const int simple_sum[] = { 0,1,-1,0,0 };
const int empty_sum[5] = { 1,0,0,0,0 };

typedef Square BoardLineArray[10];
const int NUMDIR = 8;
const int Directions[] = { 11,9,-11,-9,1,-1,10,-10,0 };
const int LineDirections[] = { 1,-1,0 };

Safety *safety[8];
//paired so direction and len are the same except the last pair where only len is the same





/*x,0,x,x,x,x,x,x,x,2,4,6*/
const int shifts[] = { -1,0,-1,-1,-1,-1,-1,-1,-1,2,4,6 };
typedef int ValuationArray[100];
ValuationArray aValuationArray;

Square undo_buffer_array[64 * 10];
Square *undo_buffer = &undo_buffer_array[0];

inline Square other_color(Square c) { return (Black + White) ^ c; }

//note white is positive, black negative
//add number of pieces to this
int Values[256];
const int values_by_color[] = { -64,-32,-16,-8,0,8,16,32,64 };
void initValues()
{
	for (int i = 0;i < 256;++i) {
		int count_black = 0;
		int count_white = 0;
		int count_ambig = 0;
		for (int p = 0;p < 4;++p) {
			int at = (i >> (p + p)) & 3;
			switch (at) {
			case 1:
				if (count_black) {
					--count_black;
					++count_ambig;
				}
				else ++count_white;
				break;
			case 2:
				if (count_white) {
					--count_white;
					++count_ambig;
				}
				else ++count_black;
				break;
			case 3:
				++count_ambig;
			}

		}
		Values[i] = values_by_color[count_white - count_black + 4] >> count_ambig;
	}
}
template <int DIR>
class Move {
public:
	static bool check(int pos, Square color, Square other, Square *r)
	{
		if (r[DIR] == other) {
			if (r[2 * DIR] == other) {
				if (r[3 * DIR] == other) {
					if (r[4 * DIR] == other) {
						if (r[5 * DIR] == other) {
							if (r[6 * DIR] == other) {
								if (r[7 * DIR] == color) {
									return true;
								}
							}
							else if (r[6 * DIR] == color) {
								return true;
							}

						}
						else if (r[5 * DIR] == color) {
							return true;
						}
					}
					else if (r[4 * DIR] == color) {
						return true;
					}
				}
				else if (r[3 * DIR] == color) {
					return true;
				}
			}
			else if (r[2 * DIR] == color) {
				return true;
			}
		}
		return false;
	}
	static int move(Square *&undo, int pos, Square color, Square other, Square *r)
	{
		if (r[DIR] == other) {
			if (r[2 * DIR] == other) {
				if (r[3 * DIR] == other) {
					if (r[4 * DIR] == other) {
						if (r[5 * DIR] == other) {
							if (r[6 * DIR] == other) {
								if (r[7 * DIR] == color) {
									r[6 * DIR] = r[5 * DIR] = r[4 * DIR] = r[3 * DIR] = r[2 * DIR] = r[DIR] = color;
									undo[5] = 6 * DIR + pos;
									undo[4] = 5 * DIR + pos;
									undo[3] = 4 * DIR + pos;
									undo[2] = 3 * DIR + pos;
									undo[1] = 2 * DIR + pos;
									undo[0] = DIR + pos;
									undo += 6;
									return 1;
								}
							}
							else if (r[6 * DIR] == color) {
								r[5 * DIR] = r[4 * DIR] = r[3 * DIR] = r[2 * DIR] = r[DIR] = color;
								undo[4] = 5 * DIR + pos;
								undo[3] = 4 * DIR + pos;
								undo[2] = 3 * DIR + pos;
								undo[1] = 2 * DIR + pos;
								undo[0] = DIR + pos;
								undo += 5;
								return 1;
							}

						}
						else if (r[5 * DIR] == color) {
							r[4 * DIR] = r[3 * DIR] = r[2 * DIR] = r[DIR] = color;
							undo[3] = 4 * DIR + pos;
							undo[2] = 3 * DIR + pos;
							undo[1] = 2 * DIR + pos;
							undo[0] = DIR + pos;
							undo += 4;
							return 1;
						}
					}
					else if (r[4 * DIR] == color) {
						r[3 * DIR] = r[2 * DIR] = r[DIR] = color;
						undo[2] = 3 * DIR + pos;
						undo[1] = 2 * DIR + pos;
						undo[0] = DIR + pos;
						undo += 3;
						return 1;
					}
				}
				else if (r[3 * DIR] == color) {
					r[2 * DIR] = r[DIR] = color;
					undo[1] = 2 * DIR + pos;
					undo[0] = DIR + pos;
					undo += 2;
					return 1;
				}
			}
			else if (r[2 * DIR] == color) {

				r[DIR] = color;
				undo[0] = DIR + pos;
				undo += 1;
				return 1;
			}
		}
		return 0;
	}
};
bool fast_move_check(int pos, Square color, Square *board)
{
	if (board[pos] != Empty) return false;
	const Square other = other_color(color);
	Square *r = &board[pos];
	return Move<1>::check(pos, color, other, r) ||
		Move<-1>::check(pos, color, other, r) ||
		Move<10>::check(pos, color, other, r) ||
		Move<-10>::check(pos, color, other, r) ||
		Move<11>::check(pos, color, other, r) ||
		Move<-11>::check(pos, color, other, r) ||
		Move<9>::check(pos, color, other, r) ||
		Move<-9>::check(pos, color, other, r);
}

bool fast_move(Square *&undo, int pos, Square color, Square *board)
{
	if (board[pos] != Empty) return false;
	const Square other = other_color(color);
	Square *r = &board[pos];
	Square *u = undo;
	if (0 != (Move<1>::move(u, pos, color, other, r) |
		Move<-1>::move(u, pos, color, other, r) |
		Move<10>::move(u, pos, color, other, r) |
		Move<-10>::move(u, pos, color, other, r) |
		Move<11>::move(u, pos, color, other, r) |
		Move<-11>::move(u, pos, color, other, r) |
		Move<9>::move(u, pos, color, other, r) |
		Move<-9>::move(u, pos, color, other, r)))
	{

		*u++ = u - undo;
		*u++ = pos;
		board[pos] = color;
		undo = u;
		return true;
	}
	return false;

}
bool move(Square *&undo, int pos, Square color, Square *board, const int *directions, bool check = false)
{
	if (board[pos] != Empty) return false;
	Square other = other_color(color);
	Square *u = undo;
	Square *r = &board[pos];
	for (int d = 0;directions[d];++d) {
		int dir = directions[d];
		if (r[dir] == other) {
			Square * o = &r[dir];
			while (o[dir] == other) o += dir;
			if (o[dir] == color) {
				if (check) return true;
				do {
					*u++ = o - board;
					*o = color;
					o -= dir;
				} while (o != r);
			}
		}
	}
	if (u != undo) {
		*u++ = u - undo;
		*u++ = pos;
		board[pos] = color;
		undo = u;
		return true;
	}
	return false;
}
void undo(Square *&undo, Square *board)
{
	if (undo_buffer == &undo_buffer_array[0]) return;
	Square *u = undo;
	board[*--u] = Empty;
	int num = *--u;
	while (num-- > 0) {
		board[*--u] ^= (White + Black);
	}
	undo = u;
}

static int blacklru[40][64] = { {
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} };

static int whitelru[40][64] = { {

		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} };



static int endgame_blacklru[40][64] = { {
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} };

static int endgame_whitelru[40][64] = { {

		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	},{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} ,{
		11,18,81,88,
		13,16,38,68,86,83,61,31,
		14,15,48,58,84,85,41,51,
		33,34,35,36,43,44,45,46,53,54,55,56,63,64,65,66,
		23,24,25,26,37,47,57,67,73,74,75,76,32,42,52,62,
		12,21,17,28,78,87,82,71,
		22,27,77,72
	} };

void increment_killers()
{
	for (int i = 1;i < 20;++i) {
		if (whitelru[i][0] != 11 && whitelru[i][1] != 18) memcpy(&whitelru[i - 1][0], &whitelru[i][0], 64 * sizeof(int));
		if (blacklru[i][0] != 11 && blacklru[i][1] != 18) memcpy(&blacklru[i - 1][0], &blacklru[i][0], 64 * sizeof(int));
	}
}
void propagate_lrus()
{
	for (int i = 2;i < 38;++i) {
		if (whitelru[i][0] == 11 && whitelru[i][1] == 18) memcpy(&whitelru[i][0], &whitelru[i - 2][0], 64 * sizeof(int));
		if (blacklru[i][0] == 11 && blacklru[i][1] == 18) memcpy(&blacklru[i][0], &blacklru[i - 2][0], 64 * sizeof(int));
	}
}

class Board {
public:
	Board() {
		for (int i = 0;i < 100;++i) board[i] = Empty;
		for (int i = 0;i < 9;++i) {
			board[90 - i * 10] = board[99 - i] = board[9 + i * 10] = board[i] = Out;
		}
		board[44] = board[55] = White;
		board[45] = board[54] = Black;
	}
	bool move(Square *&undo, int pos, Square color, bool check = false) {
		if (!check) return fast_move(undo, pos, color, board);
		return fast_move_check(pos, color, board);
	}
	void undo(Square *&undo, Square *board)
	{
		::undo(undo, board);
	}
	BoardArray board;
	void print()
	{
		int b = 0, w = 0;
		const char *p = ".*Ox#";
		printf("     1 2 3 4 5 6 7 8\n");
		for (int i = 0;i < 100;++i) {
			if (i % 10 == 0) {
				if (i == 0 || i == 90) printf("   ");
				else printf(" %i ", i / 10);
			}
			putchar(p[board[i]]);putchar(' ');
			if (board[i] == Black) ++b;
			else if (board[i] == White) ++w;
			if (i % 10 == 9) putchar('\n');
		}
		printf("%i black pieces, %i white pieces\n", b, w);
	}


	bool collect_primary_alphabeta(int collect, int collect_max, int * move_collection, int depth, Square color, Square root_color, bool use_move_count);

	int alphabeta(int &move_at, int depth, int alpha, int beta, Square color, Square root_color, bool use_move_count);
	int movelist_alphabeta(int* move_collection, int &move_at, int depth, Square color, Square root_color, bool use_move_count);
	int endgame_alphabeta(int &move_at, int depth, int alpha, int beta, Square color, Square root_color, bool passed = false);


#ifdef NO_OPTIMIZATION
	bool next_move(int &move_number, int &move_at, Square color, int)
	{
		if (move_number > 63) return false;
		int at = move_at;
		do {
			if (move_number == 64) return false;
			at = (move_number & 7) + 11 + (move_number >> 3) * 10;
			++move_number;
		} while (!move(undo_buffer, at, color));
		move_at = at;
		return true;
	}
	void killer(int move_number, Square color, int depth) {}
#else
	void killer2(int move_number, Square color, int depth)
	{
		if (move_number == 0) return;
		int *lru;
		if (color == White)lru = endgame_whitelru[depth];
		else lru = endgame_blacklru[depth];
		int at = lru[move_number];
		for (int i = move_number - 1;i >= 0;--i) lru[i + 1] = lru[i];
		lru[0] = at;
	}
	void killer(int move_number, Square color, int depth)
	{
		if (move_number <= 1) return;
		int *lru;
		if (color == White)lru = whitelru[QUIESCENT_DEPTH + depth];
		else lru = blacklru[QUIESCENT_DEPTH + depth];
		int at = lru[move_number];
		int a0 = lru[0];
		int a1 = lru[move_number >> 1];

		lru[0] = at;
		lru[move_number >> 1] = a0;
		lru[move_number] = a1;
	}
	void endgame_killer(int move_number, Square color, int depth)
	{
		static int countdown = 100000;
		if (countdown) {
			--countdown;
			return killer2(move_number, color, depth);
		}
		if (move_number <= 1) return;
		int *lru;
		if (color == White)lru = endgame_whitelru[QUIESCENT_DEPTH + depth];
		else lru = endgame_blacklru[QUIESCENT_DEPTH + depth];
		int at = lru[move_number];
		int a0 = lru[0];
		int a1 = lru[move_number >> 1];

		lru[0] = at;
		lru[move_number >> 1] = a0;
		lru[move_number] = a1;
	}


	bool next_move(int &move_number, int &move_at, Square color, int depth)
	{
		if (move_number > 63) return false;
		int at;
		do {
			if (move_number == 64) return false;
			//at = (move_number >> 3) * 10 + (move_number & 7) + 11;
			//++move_number;
			if (color == White)at = whitelru[QUIESCENT_DEPTH + depth][move_number++];
			else at = blacklru[QUIESCENT_DEPTH + depth][move_number++];
		} while (!move(undo_buffer, at, color));
		move_at = at;
		return true;
	}
	bool endgame_next_move(int &move_number, int &move_at, Square color, int depth)
	{
		if (move_number > 63) return false;
		int at;
		do {
			if (move_number == 64) return false;
			//at = (move_number >> 3) * 10 + (move_number & 7) + 11;
			//++move_number;
			if (color == White)at = endgame_whitelru[QUIESCENT_DEPTH + depth][move_number++];
			else at = endgame_blacklru[QUIESCENT_DEPTH + depth][move_number++];
		} while (!move(undo_buffer, at, color));
		move_at = at;
		return true;
	}
#endif
	bool next_move_not_in(int *saved_moves, int &move_number, int &move_at, Square color, int depth)
	{
		while (next_move(move_number, move_at, color, depth)) {
			for (int i = 1;i < *saved_moves;++i) {
				if (saved_moves[i] == move_at) goto again;
			}
			return true;
		again:;
			undo(undo_buffer, board);
		}
		return false;
	}
	int find_move(int depth, Square color, bool use_move_count);
	bool can_move(Square color)
	{
		for (int p = 11;p <= 88;++p) if (move(undo_buffer, p, color, true)) return true;
		return false;
	}

	bool end_of_game()
	{
		return !can_move(White) && !can_move(Black);
	}
	int forced_move(int & move_at, Square color)
	{
		int moves = 0;
		move_at = 0;
		for (int p = 11;p <= 88;++p) {
			if (move(undo_buffer, p, color, true)) {
				move_at = p;
				if (++moves == 2) return false;
			}
		}
		return true;
	}
	int count_moves(int & move_at, Square color)
	{
		int moves = 0;
		move_at = 0;
		for (int p = 11;p <= 88;++p) {
			if (move(undo_buffer, p, color, true)) {
				move_at = p;
				++moves;
			}
		}
		return moves;
	}

	void input(Square color, const char *command = NULL)
	{
		do {
			char buf[20];
			print();
			if (color == White) fputs("White's", stdout);
			else fputs("Black's", stdout);
			fputs(" move (p for pass, u undo, a[n] auto, b[n] alt auto):", stdout);
			if (command) strcpy(buf, command);
			else fgets(buf, sizeof(buf) - 1, stdin);
			int i = -1;
			sscanf(buf, "%i", &i);
			if (buf[0] == 'p') return;

			if (buf[0] == 'a') {
				int m = find_move(buf[1] - '0', color, false);
				printf("move at %i\n", m);
				if (!move(undo_buffer, m, color)) {
					printf("pass.\n");
				}
				return;

			}
			if (buf[0] == 'b') {
				int m = find_move(buf[1] - '0', color, true);
				printf("move at %i\n", m);
				if (!move(undo_buffer, m, color)) {
					printf("pass.\n");
				}
				return;

			}

			if (buf[0] == 'u') {
				undo(undo_buffer, board);

				return;
			}
			if (i < 11 || i>99 || !move(undo_buffer, i, color)) {
				printf("bad move.\n");
			}
			else return;
		} while (true);
	}
};

//note is singleton
class Valuator
{
public:

	BoardLineArray board;

	//messing with algorithm, max 4 fakes per line
	int CalcSafety(int len, int c, int depth = 0)//note board is one input, undo_buffer another
	{
		for (int p = 0;p < len;++p) {
			for (int color = White; color <= Black;++color) {
				if (board[p + 1] == Empty) {
					if (move(undo_buffer, p + 1, color)) {
						for (int s = 0;s < len;++s) c |= board[s + 1] << (s + s);
						c |= CalcSafety(len, c, depth);
						undo(undo_buffer);
					}
					else if (depth<3) {
						board[p + 1] = color;
						c |= color << (p + p);
						c |= CalcSafety(len, c, depth + 1);
						board[p + 1] = Empty;
					}
				}
			}
		}
		return c;
	}
	void CalcValuate(int len)
	{
		board[len + 1] = Out;
		for (int c = 0;c < 1 << (len + len);++c) {
			for (int i = 0;i < len;++i) {
				int mask = 3 << (i + i);
				if ((c&mask) == mask) goto cont_c;
				board[i + 1] = (c&mask) >> (i + i);
			}
			//the board line now has every starting position
			//do every possible move from this position, and or the results
			//every square that isn't 3 is safe.
			//calc safety[i-1][c]
			safety[len - 1][compress3(c)] = CalcSafety(len, c);
			//			safety[len - 1][c] = (((c & 0xaaaaaaaa) >> 1) | ((c & 0x55555555) << 1) | c) & CalcSafety(len, c);
			//printf("safety len=%i[%x]=%x\n",len,c,safety[len - 1][c]);
		cont_c:;
		}
	}

	Valuator() {
		init_compress();
		int len = 4;
		for (int i = 1;i <= 8;++i) {
			safety[i - 1] = new Safety[len];
			memset(safety[i - 1], 0, len * sizeof(safety[i - 1][0]));
			len = len * 4;
		}
		for (int i = 0;i < 10;++i) board[i] = Empty;
		board[0] = board[9] = Out;
		for (int i = 8; i >= 1;--i) CalcValuate(i);
		initValues();

		/*
		len = 4;
		for (int i = 1;i <= 8;++i) {
		printf("safety of length %i\n", len);
		for (int j = 0;j < len;++j) {
		if (safety[i - 1][j]) fprintf(stderr,"%8x ",safety[i - 1][j]);
		}
		len = len * 4;
		}
		*/
	}
	~Valuator() {
		for (int i = 1;i <= 8;++i) delete[] safety[i - 1];
	}
	bool move(Square *&undo, int pos, Square color, bool check = false) {
		return ::move(undo, pos, color, board, LineDirections, check);

	}
	void undo(Square *&undo)
	{
		::undo(undo, board);
	}

	int find_empty(BoardArray in)
	{
		int sum = 0;
		for (int i = 11;i <= 88;++i) sum += empty_sum[in[i]];
		return sum;
	}
	bool quiescent(BoardArray in)
	{
		if (Empty == in[88] && (Empty != in[77] || Empty != in[78]) || Empty != in[87]) return false;
		if (Empty == in[18] && (Empty != in[27] || Empty != in[28] || Empty != in[17])) return false;
		if (Empty == in[11] && (Empty != in[22] || Empty != in[21] || Empty != in[12])) return false;
		if (Empty == in[81] && (Empty != in[72] || Empty != in[71] || Empty != in[82])) return false;
		return true;
	}
	int find_simple_value(BoardArray in, Square root_color)
	{
		int s1 = 0, s2 = 0, s3 = 0, s4 = 0;
		int i;
		{
			//#pragma omp parallel for reduction(+:sum)
			for (i = 11; i <= 85; i += 4) {
				s1 += simple_sum[in[i]];
				s2 += simple_sum[in[1 + i]];
				s3 += simple_sum[in[2 + i]];
				s4 += simple_sum[in[3 + i]];
			}
		}
		//assert(root_color == White);
		const int sum = s1 + s2 + s3 + s4;
		if (root_color == Black) return -sum;
		return sum;
	}
	int find_value(BoardArray in, Square root_color, bool use_move_count, bool display)
	{
		for (int i = 11;i <= 88;++i) aValuationArray[i] = 0;

		CompressedBoard cbs;
		int *store_value_in_table;

		for (int i = 0;i < 8; i += 2) {
			int c = 0;
			int c2 = 0;

			for (int j = Valuations[i].pos, j2 = Valuations[1 + i].pos, k = 1;k <= Valuations[i].len;++k, j += Valuations[i].dir, j2 += Valuations[i].dir) {
				c = (c << 2) + in[j];
				c2 = (c2 << 2) + in[j2];

			}

			cbs[i] = compress3(c);
			cbs[i+1]= compress3(c2);
		}


		if (TranspositionEntry::find_and_fill(store_value_in_table, cbs,0)) return *store_value_in_table;
		for (int i = 0;Valuations[i].pos; i += 2) {
			int c;
			int c2;
			if (i < 8) {
				c = safety[Valuations[i].len - 1][cbs[i]];
				c2 = safety[Valuations[i].len - 1][cbs[i + 1]];
			}
			else {
				c = 0;
				c2 = 0;
				for (int j = Valuations[i].pos, j2 = Valuations[1 + i].pos, k = 1;k <= Valuations[i].len;++k, j = j + Valuations[i].dir, j2 = j2 + Valuations[1 + i].dir) {
					c = (c << 2) + in[j];
					c2 = (c2 << 2) + in[j2];
				}
				c = safety[Valuations[i].len - 1][compress3(c)];
				c2 = safety[Valuations[i].len - 1][compress3(c2)];
			}
			int s = shifts[Valuations[i].dir];
			int s2 = shifts[Valuations[1 + i].dir];
			assert(s >= 0);
			for (int j = Valuations[i].pos + Valuations[i].dir*(Valuations[i].len - 1),
				j2 = Valuations[1 + i].pos + Valuations[1 + i].dir*(Valuations[i].len - 1),
				k = 1;k <= Valuations[i].len;++k,
				j = j - Valuations[i].dir,
				j2 = j2 - Valuations[1 + i].dir
				) {
				aValuationArray[j] |= (c & 3) << s;
				aValuationArray[j2] |= (c2 & 3) << s2;
				c >>= 2;
				c2 >>= 2;
			}
		}
		//at this point I should have a board of safety values to flatten
		int sum = 0;
		static int intrans[] = { 0,2,-2,0,0 };
		for (int i = 11;i <= 88;++i) sum += Values[aValuationArray[i]] + intrans[in[i]];
		if (display) {
			const char *p = ".*Ox#";
			printf("          1      2      3      4      5      6      7      8\n");
			for (int i = 0;i < 100;++i) {
				if (i % 10 == 0) {
					if (i == 0 || i == 90) printf("   ");
					else printf(" %i ", i / 10);
				}
				printf("%-5i ", //aValuationArray[i],
					Values[aValuationArray[i]] + intrans[in[i]]);putchar(p[in[i]]);putchar(' ');
				if (i % 10 == 9) putchar('\n');
			}

		}
		if (use_move_count) {
			int white_moves = 0, black_moves = 0;
			for (int p = 11;p <= 88;++p) if (fast_move_check(p, White, in))white_moves += 7;
			for (int p = 11;p <= 88;++p) if (fast_move_check(p, Black, in))black_moves += 7;

			/*
			for (int p = 11;p <= 88;++p) {
			bool m = fast_move_check(p, White, in);
			assert(m ==
			::move(undo_buffer, p, White, in, Directions, true));

			if (m) {
			white_moves += 7;
			}
			}
			for (int p = 11;p <= 88;++p) {
			bool m = fast_move_check(p, Black, in);
			assert(m == ::move(undo_buffer, p, Black, in, Directions, true));
			if (m) {
			black_moves += 7;
			}
			}
			*/

			if (white_moves < 2 && black_moves>white_moves) black_moves <<= 2 - white_moves;
			else if (black_moves < 2 && white_moves>black_moves) white_moves <<= 2 - black_moves;
			sum = sum + white_moves - black_moves;

			if (white_moves == 0 && black_moves == 0) {
				if (find_simple_value(in, root_color) < 0) sum = -100000;
				else sum = 100000;
			
				*store_value_in_table = sum;
//				printf("end of game %i \n",sum);
				return sum;
			}
		}
		///*

		//11 12 13 14 15 16 17 18
		//21 22 23 24 25 26 27 28
		//31 32 33 34 35 36 37 38
		//41 42 43 44 45 46 47 48
		//51 52 53 54 55 56 57 58
		//61 62 63 64 65 66 67 68
		//71 72 73 74 75 76 77 78
		//81 82 83 84 85 86 87 88


		const int corner_fix2[] = { 11,18,81,88 };
		for (int i = 0;i < 4;++i) {
			if (board[corner_fix2[i]] == White) sum += 1800; else sum -= 1800;
		}


		//setup scoring
		const int corner_fix4[] = { 11,12,22,21,18,17,27,28,81,71,72,82,88,78,77,87 };
		for (int i = 0;i < 16;i += 4) {
			if (board[corner_fix4[i]] == Empty) {
				if (corner_fix4[i + 1] == White) sum -= 450;
				else if (corner_fix4[i + 1] == White) sum += 450;
				else {
					if (move(undo_buffer, corner_fix4[i + 1], White, true)) sum -= 160;
					if (move(undo_buffer, corner_fix4[i + 1], Black, true)) sum += 160;
				}

				if (corner_fix4[i + 3] == White) sum -= 450;
				else if (corner_fix4[i + 3] == White) sum += 450;
				else {
					if (move(undo_buffer, corner_fix4[i + 3], White, true)) sum -= 160;
					if (move(undo_buffer, corner_fix4[i + 3], Black, true)) sum += 160;
				}

				if (corner_fix4[i + 2] == White) sum -= 800;
				else if (corner_fix4[i + 2] == White) sum += 800;
				else {
					if (move(undo_buffer, corner_fix4[i + 2], White, true)) sum -= 500;
					if (move(undo_buffer, corner_fix4[i + 2], Black, true)) sum += 500;
				}
			}
		}

		//*/


		//		assert(root_color == White);
		if (root_color == Black) sum = -sum;
		//? how to count options?
		*store_value_in_table = sum;
//		printf("%i\n", sum);
		return sum;
	}

#define NUM_PRIMARY 4
#define NUM_PRIMARY_MAX (2*NUM_PRIMARY)


	const int inner_corners[4] = { 22,27,72,77 };
	const int corners[4] = { 11,18,81,88 };
	void remove_dangerous_moves(int *moves, BoardArray in, Square color)
	{

		//11 12 13 14 15 16 17 18
		//21 22 23 24 25 26 27 28
		//31 32 33 34 35 36 37 38
		//41 42 43 44 45 46 47 48
		//51 52 53 54 55 56 57 58
		//61 62 63 64 65 66 67 68
		//71 72 73 74 75 76 77 78
		//81 82 83 84 85 86 87 88
		/*
		if corner not taken then any move that sets in from corner to my color is dangerous
		any that makes side gap is slightly dangerous - hard to test
		any that sets side to my corner is very slightly dangerous
		*/
		bool danger[NUM_PRIMARY_MAX + 1];
		bool corners_not_taken[4] = { in[11] == Empty,in[18] == Empty,in[81] == Empty,in[88] == Empty };
		bool inner_corners_not_taken[4] = { in[22] != color,in[27] != color,in[72] != color,in[77] != color };
		int count = 0;
		for (int i = 1;i <= moves[0];++i) {
			//::move(undo_buffer, moves[i], color, in, Directions);
			fast_move(undo_buffer, moves[i], color, in);
			bool dangerous = false;
			for (int c = 0;c < 4;++c) {
				if (corners_not_taken[c] && inner_corners_not_taken[c] && in[inner_corners[c]] == color && in[corners[c]] != color) {
					dangerous = true;
					++count;
					break;
				}
			}
			::undo(undo_buffer, in);
			danger[i] = dangerous;
		}
		if (count == 0 || count == moves[0]) return;
		int copy[NUM_PRIMARY_MAX + 1];

		for (int i = 0;i <= moves[0];++i) copy[i] = moves[i];
		moves[0] = 0;
		int j = 1;
		for (int i = 1;i <= copy[0];++i)
			if (!danger[i]) {
				++moves[0];
				moves[moves[0]] = copy[i];
			}

	}
};

Valuator valuator;
bool in_endgame = false;

int Board::find_move(int depth, Square color, bool use_move_count)
{
#ifdef SIMPLE_SEARCH
	int empty_depth = valuator.find_empty(board);
	int moveAt = 0;
	if (empty_depth < 17) {
		printf("endgame ");
		endgame_alphabeta(moveAt, empty_depth, -INT_MAX, INT_MAX, color, color, false);
	}
	else alphabeta(moveAt, depth, -INT_MAX, INT_MAX, color, color, use_move_count);
	return moveAt;
#else
	int empty_depth = valuator.find_empty(board);
	int moveAt = 0;
	if (empty_depth < 19) {
		printf("endgame ");
		if (in_endgame == false) {
			propagate_lrus();
			in_endgame = true;

		}
		endgame_alphabeta(moveAt, empty_depth, -INT_MAX, INT_MAX, color, color, false);
		return moveAt;
	}
	in_endgame = false;
	int move_collection[NUM_PRIMARY_MAX + 1];

	// ed = 24/24  ed=26/22 ed=28/20 ed=30/18 
	//prime the endgame refutation
	//	int endgame_reflect = 48 - empty_depth;
	//	if (endgame_reflect>0 ) endgame_alphabeta(moveAt, endgame_reflect, -INT_MAX, INT_MAX, color, color, false);
	if (collect_primary_alphabeta(NUM_PRIMARY, NUM_PRIMARY_MAX, move_collection, depth - 2, color, color, use_move_count)) {

		valuator.remove_dangerous_moves(move_collection, board, color);
		//undo(undo_buffer, board);
		movelist_alphabeta(move_collection, moveAt, depth, color, color, use_move_count);
		//alphabeta(moveAt, depth, -INT_MAX, INT_MAX, color, color, use_move_count);
		return moveAt;
	}
	return 0;
	//bool Board::collect_primary_alphabeta(int collect, int * move_collection, int depth, Square color, Square root_color, bool use_move_count)

#endif
}

int Board::endgame_alphabeta(int &move_at, int depth, int alpha, int beta, Square color, Square root_color, bool passed)
{
	if (depth == 0) {
		return valuator.find_simple_value(board, root_color);
	}
	int at, move_number = 0;
	int inner_move;
	if (color == root_color) { //maximizing
		int v = -INT_MAX;
		while (endgame_next_move(move_number, at, color, depth)) {

			int n = endgame_alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color);
			if (n > v) {
				v = n;
				move_at = at;
				endgame_killer(move_number - 1, color, depth);
			}
			if (v > alpha) {
				alpha = v;
			}

			undo(undo_buffer, board);
			if (beta <= alpha) {
				break; //cut off
			}
		}
		if (v == -INT_MAX) {
			if (passed) return valuator.find_simple_value(board, root_color);
			move_at = 0;
			return endgame_alphabeta(inner_move, depth, alpha, beta, other_color(color), root_color, true);//passed
		}
		return v;
	}
	else {//minimizing
		int v = INT_MAX;
		while (endgame_next_move(move_number, at, color, depth)) {
			int n = endgame_alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color);
			if (n < v) {
				v = n;
				move_at = at;
				endgame_killer(move_number - 1, color, depth);
			}
			if (v < beta) {
				beta = v;
			}
			undo(undo_buffer, board);
			if (beta <= alpha) {
				break; //cut off
			}
		}
		if (v == INT_MAX) {
			if (passed) return valuator.find_simple_value(board, root_color);
			move_at = 0;
			return endgame_alphabeta(inner_move, depth, alpha, beta, other_color(color), root_color, true);//passed
		}
		move_at = at;
		return v;
	}

};



bool Board::collect_primary_alphabeta(int collect, int collect_max, int * move_collection, int depth, Square color, Square root_color, bool use_move_count)
{
	int current_move_pos = 0;
	do {
		int alpha = -INT_MAX;
		int beta = INT_MAX;
		move_collection[0] = ++current_move_pos;
		move_collection[current_move_pos] = 0;
		//depth will never be zero at this level
		int at, move_number = 0;
		int inner_move;
		if (color == root_color) { //maximizing
			int v = -INT_MAX;
			while (next_move_not_in(move_collection, move_number, at, color, depth)) {

				int n = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);
				if (n > v) {
					//just take bonehead move out of the list if there's an alt
					//* 
					if (at == 22 || at == 27 || at == 77 || at == 72) collect = __min(collect_max, collect + 1);
					//*/
					v = n;
					move_collection[current_move_pos] = at;
					//					killer(move_number - 1, color);
				}
				if (v > alpha) {
					alpha = v;
				}

				undo(undo_buffer, board);
				if (beta <= alpha) {
					break; //cut off
				}
			}
			if (v == -INT_MAX) {
				//				move_collection[current_move_pos] = 0;
				v = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);//passed
				continue;
			}
			continue;
		}
		else {//minimizing
			int v = INT_MAX;
			while (next_move_not_in(move_collection, move_number, at, color, depth)) {
				int n = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);
				//{}{}{} getting an extra undo somewhere
				if (n < v) {
					//just take bonehead move out of the list if there's an alt
					//*
					if (at == 22 || at == 27 || at == 77 || at == 72) collect = __min(collect_max, collect + 1);
					//*/
					v = n;
					move_collection[current_move_pos] = at;
					//					killer(move_number - 1, color);
				}
				if (v < beta) {
					beta = v;
				}
				undo(undo_buffer, board);
				if (beta <= alpha) {
					break; //cut off
				}
			}
			if (v == INT_MAX) {
				//				move_collection[current_move_pos] = 0;
				v = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);//passed
				continue;
			}
			move_collection[current_move_pos] = at;
			continue;
		}
	} while (current_move_pos < collect);
	while (move_collection[0] != 0 && move_collection[move_collection[0]] == 0) {
		--move_collection[0];
	}
	return move_collection[0] != 0;
}

int Board::movelist_alphabeta(int* move_collection, int &move_at, int depth, Square color, Square root_color, bool use_move_count)
{
	int alpha = -INT_MAX;
	int beta = INT_MAX;
	int at, move_number = 0;
	int move_list_counter = 0;
	int inner_move;
	if (color == root_color) { //maximizing
		int v = -INT_MAX;
		while (++move_list_counter <= move_collection[0]) {
			at = move_collection[move_list_counter];
			assert(at >= 11 && at <= 88);
			bool moved = move(undo_buffer, at, color);
			assert(moved);
			int n = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);
			if (n > v) {
				v = n;
				move_at = at;
				//				killer(move_number - 1, color);
			}
			if (v > alpha) {
				alpha = v;
			}

			undo(undo_buffer, board);
			if (beta <= alpha) {
				break; //cut off
			}
		}
		if (v == -INT_MAX) {
			move_at = 0;
			return alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);//passed
		}
		return v;
	}
	else {//minimizing
		int v = INT_MAX;
		while (++move_list_counter <= move_collection[0]) {
			at = move_collection[move_list_counter];
			assert(at >= 11 && at <= 88);
			bool moved = move(undo_buffer, at, color);
			assert(moved);
			int n = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);
			if (n < v) {
				v = n;
				move_at = at;
				//				killer(move_number - 1, color);
			}
			if (v < beta) {
				beta = v;
			}
			undo(undo_buffer, board);
			if (beta <= alpha) {
				break; //cut off
			}
		}
		if (v == INT_MAX) {
			move_at = 0;
			return alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);//passed
		}
		move_at = at;
		return v;
	}

}


int Board::alphabeta(int &move_at, int depth, int alpha, int beta, Square color, Square root_color, bool use_move_count)
{
#if (QUIESCENT_DEPTH!=0)
	if (depth == -QUIESCENT_DEPTH || (depth <= 0 && valuator.quiescent(board)) || end_of_game()) {
#else
	if (depth == 0 || end_of_game()) {
#endif
		return valuator.find_value(board, root_color, use_move_count, false);
	}
	int at, move_number = 0;
	int inner_move;
	if (color == root_color) { //maximizing
		int v = -INT_MAX;
		while (next_move(move_number, at, color, depth)) {
			int *to_store,n;
//			if (TranspositionEntry::find_and_fill(to_store, board, depth)) {
//				n = *to_store;
//			}
//			else {
				n = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);
//				*to_store = n;
//			}
			if (n > v) {
				v = n;
				move_at = at;
				killer(move_number - 1, color, depth);
			}
			if (v > alpha) {
				alpha = v;
			}

			undo(undo_buffer, board);
			if (beta <= alpha) {
				break; //cut off
			}
		}
		if (v == -INT_MAX) {
			move_at = 0;
			return alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);//passed
		}
		return v;
	}
	else {//minimizing
		int v = INT_MAX;
		while (next_move(move_number, at, color, depth)) {
			int *to_store, n;
//			if (TranspositionEntry::find_and_fill(to_store, board, depth)) {
//				n = *to_store;
//			}
//			else {
				n = alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);
//				*to_store = n;
//			}
			if (n < v) {
				v = n;
				move_at = at;
				killer(move_number - 1, color, depth);
			}
			if (v < beta) {
				beta = v;
			}
			undo(undo_buffer, board);
			if (beta <= alpha) {
				break; //cut off
			}
		}
		if (v == INT_MAX) {
			move_at = 0;
			return alphabeta(inner_move, depth - 1, alpha, beta, other_color(color), root_color, use_move_count);//passed
		}
		move_at = at;
		return v;
	}

	}

	
LARGE_INTEGER frequency;        // ticks per second
LARGE_INTEGER t1, t2;           // ticks
double elapsedTime;


int main()
{
	Board b;
	QueryPerformanceFrequency(&frequency);
	// start timer
	QueryPerformanceCounter(&t1);
	bool black_passed;
	bool white_passed;
	do {
		if (!b.can_move(Black)) {
			if (white_passed) {
				printf("game over\n");
				break;
			}
			printf("Black must pass \n");
			black_passed = true;
		}
			else {
				b.input(Black, "b9");
			black_passed = false;
		}
		//increment_killers();
//		valuator.find_value(b.board, White,false, true);
		if (!b.can_move(White)) {
			if (black_passed) {
				printf("game over\n");
				break;
			}
			printf("White must pass \n");
			white_passed = true;
		}
		else {
			b.input(White, "b9");
			white_passed = false;
		}
		//increment_killers();
		//		valuator.find_value(b.board, Black, false,true);
	} while (true);
	b.print();
	QueryPerformanceCounter(&t2);

	// compute and print the elapsed time in millisec
	elapsedTime = (t2.QuadPart - t1.QuadPart) * 1000.0 / frequency.QuadPart;
	std::cout << "game took " << elapsedTime << "\n";
	getchar();
    return 0;
}

